{% extends "base_central.html" %}

{% load i18n %}
{% load my_filters %}

{% block title %}{% trans "Installation" %}{% endblock %}

{% block install_active %}active{% endblock install_active %}

{% block headcss %}
<style>
label {
    width: 59px;
    display: block;
    float: left;
    text-align: right;
    padding-right: 10px;
    font-weight: bold;
}
input {
	margin-bottom: 15px;
}
.submit {
    margin-left: 71px;
}
ol li {
    list-style-type: decimal;
    margin-left:15px;
}
span.title {
    text-decoration: underline;
}
ol li ol li {
    list-style-type: lower-alpha;
    margin-left:25px;
}

</style>
{% endblock headcss %}

{% block content %}
{% if not request.user.is_authenticated %}
<div>
    There are three methods for installing KA Lite:
    <ol>
        <li><b>Recommended </b><span class="title">Registered User Install</span>
            <ol>
                <li><a href="{% url registration_register %}">Register for an account</a> with KA Lite, then <a href="{% url auth_login %}">login</a>.</li>
                <li>Return to this page to download your preconfigured copy of KA Lite!</li>
            </ol>
        </li>
        <li><span class="title">Windows Installer</span>
            <ol>
                <li><a href="">Download our Windows Installer</a>, and walk through the installation wizard.</li>
                <li>Follow our <a href="{{ wiki_url }}/installation/">post-install setup instructions</a>.</li>
            </ol>
        </li>
        <li><span class="title">Github Installation</span>
            <ol>
                <li>Follow our <a href="{{ wiki_url }}/installation/">github installation.</li>
                <li>Follow our <a href="{{ wiki_url }}/installation/">post-install setup instructions</a>.</li>
            </ol>
        </li>
    </ol>
</div>
{% else %}
    <form method="post" class="basic-form">
    {% csrf_token %}
        <div class="selection" id="select_organization">
            <div class="subtitle">{% trans "Select Organization" %}</div>
            <select name="organization" id="organization">
                <option {% if not selected_organization %}selected{% endif %}>----</option>
                    {% for pk,org in organizations.items %}
                    <option value="{{ pk }}" {% if selected_organization.id == org.id %}selected{% endif %}>{{ org }} : {{org.id}}</option>
                    {% endfor %}
            </select>
        </div>

        <div class="selection" id="select_zone">
            <div class="subtitle">{% trans "Select Zone" %}</div>
            <select name="zone" id="zone">
                <option {% if not selected_zone %}selected{% endif %}>----</option>
                {% for zone in zones %}
                <option value="{{ zone.id }}"{% if selected_zone.id == zone.id %}selected{% endif %}>{{ zone }}</option>
                {% endfor %}
            </select>
        </div>


        <div class="selection" id="select_num_certificates">
            <div class="subtitle">{% trans "Select # Certificates" %}</div>
            <select name="num_certificates" id="num_certificates">
                {% mkrange 1 50 as some_range %}
                {% for n in some_range %}
                <option value="{{ n }}"{% if num_certificates == n|stringformat:"d" %}selected{% endif %}>{{ n }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="selection" id="submit">
            <div class="subtitle"></div>
            <input type="submit" value="{% trans "Download now!"%}" />
        </div>
    </form>
        <div>
        install_certificates = {{ install_certificates }}
        </div>
    
<script>

function setGetParam(name, val) {
    var vars = {};
    var parts = window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
        vars[key] = value;
    });
    if (val != "" && val != "----") {
        vars[name] = val;
    } else {
        delete vars[name];
    }
    url = "?" + $.param(vars);
    window.location.href = url;    
}

$(function() {
    // When selected, refresh the page
    $("#organization").change(function(){
       setGetParam("organization", $("#organization option:selected").val()); 
    });
    
    $("#zone").change(function(){
       setGetParam("zone", $("#zone option:selected").val()); 
    });
    
    $("#num_certificates").change(function(){
       setGetParam("num_certificates", $("#num_certificates option:selected").val()); 
    });
    
});
</script>
{% endif %}
{% endblock %}
