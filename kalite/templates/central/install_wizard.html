{% extends "base_central.html" %}

{% load i18n %}
{% load my_filters %}

{% block title %}{% trans "Installation" %}{% endblock %}

{% block install_active %}active{% endblock install_active %}

{% block headcss %}
<style>
label {
    width: 59px;
    display: block;
    float: left;
    text-align: right;
    padding-right: 10px;
    font-weight: bold;
}
input {
	margin-bottom: 15px;
}
.submit {
    margin-left: 71px;
}
ol li {
    list-style-type: decimal;
}
span.title {
    text-decoration: underlsine;
    font-weight: bold;
    font-size:12pt;
}
ol li ol li {
    list-style-type: lower-alpha;
    margin-left:25px;
}

.instructions ol {
    margin-bottom: 5px;
    font-size:10pt;
    margin-left:20px;
}
.subtitle{
    float:left;
    width:120px;
}
.select {
    float:left;
}
.selection {
    width:100%;
    line-height: 25px;
    height:25px;
}
.recommended, .not-recommended { 
    font-weight: bold;
    font-size:9pt;
}

.instructions dl {
    margin-bottom: 20px;
    margin-left: 25px;
}
</style>
{% endblock headcss %}

{% block content %}
    {% comment "Header instructions" %}{% endcomment %}
    <div class="instructions">
        <h1>Installation Instructions</h1>
        {% if not request.user.is_authenticated %}
        <p>There are three ways for installing KA Lite.  Choose the one best for you!</p>
        <p>
            <ol>
                <li><span class="title">Registered User Install</span> <span class="recommended">(Recommended!) </span>
                    <ol>
                        <li><a href="{% url registration_register %}">Register for an account</a> with KA Lite, then <a href="{% url auth_login %}">login</a>.</li>
                        <li>Return to this page to download your preconfigured copy of KA Lite!</li>
                        <li>Unzip the zip file and <a href="{{ wiki_url }}installation/">run the installation</a>.</li>
                    </ol>
                    <dl>
                        <dd>Advantages: fully offline install, no post-install setup required!</dd>
                        <dd>Disadvantages: If you don't have <a href="{{ wiki_url }}installation/">python, you must install yourself</a>.</dd>
                    </dl>
                </li>
                <li><span class="title">Windows Installer</span> <span class="recommended">(Recommended!) </span>
                    <ol>
                        <li><a href="https://dl.dropboxusercontent.com/u/1080765/KALiteSetup.exe">Download our Windows Installer</a>, and walk through the installation wizard.</li>
                        <li>Follow our <a href="{{ wiki_url }}using-ka-lite/deployment/screencasts/">post-install setup instructions</a>.</li>
                    </ol>
                    <dl>
                        <dd>Advantages: Helpful UI! Installs all necessary components</dd>
                        <dd>Disadvantages: Windows only. <a href="{{ wiki_url }}using-ka-lite/deployment/screencasts">Post-install setup</a> required.</dd>
                    </dl>
                </li>
                <li><span class="title">Github Installation</span> <span class="not-recommended">(Not Recommended) </span>
                    <ol>
                        <li>Follow our <a href="{{ wiki_url }}installation/">github installation instructions</a> for your platform.</li>
                        <li>Follow our <a href="{{ wiki_url }}using-ka-lite/deployment/screencasts/">post-install setup instructions</a>.</li>
                    </ol>
                    <dl>
                        <dd>Advantages: Easy to get software updates.</dd>
                        <dd>Disadvantages: If you don't have <a href="{{ wiki_url }}installation/">python or git, you must install yourself</a>.  <a href="{{ wiki_url }}using-ka-lite/deployment/screencasts">Post-install setup</a> required.</dd>
                    </dl>
                </li>
            </ol>
        </p>
        {% else %}
        <p>
            <ol>
                <li>Select the organization and zone you'd like to install KA Lite devices for.</li>
                <li>Select the MAXIMUM number of devices you'd like to install.</li>
                <li>Click "Download KA Lite!"</li>
                <li>Save the zip file</li>
                <li>Copy to the device you'd like to install KA Lite on, and unzip.</li>
                <li>Run the installation script.</li>
            </ol>
        </p>
        {% endif %}
    </div>
    
    {% comment "Form for downloading KALite is accessible only to authenticatd users" %}{% endcomment %}
    {% if request.user.is_authenticated %}
    <div class="install-form">
        <h2>Installation Form</h2>
        <div class="errors">{% for err in errors %}{{ err }}{% endfor %}</div>
        <form method="post" class="basic-form">
        {% csrf_token %}
            <div class="selection" id="select_organization">
                <div class="subtitle">{% trans "Select Organization" %}</div>
                <div class="select">
                    <select name="organization" id="organization">
                        <option {% if not selected_organization %}selected{% endif %}>----</option>
                            {% for pk,org in organizations.items %}
                            <option value="{{ pk }}" {% if selected_organization.id == org.id %}selected{% endif %}>{{ org }} : {{org.id}}</option>
                            {% endfor %}
                    </select>
                </div>
            </div>
        
            {% if selected_organization %}
            <div class="selection" id="select_zone">
                <div class="subtitle">{% trans "Select Zone" %}</div>
                <div class="select">
                    <select name="zone" id="zone">
                        <option {% if not selected_zone %}selected{% endif %}>----</option>
                        {% for zone in zones %}
                        <option value="{{ zone.id }}"{% if selected_zone.id == zone.id %}selected{% endif %}>{{ zone }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            {% endif %}

            {% if selected_organization and selected_zone %}
            <div class="selection" id="select_num_certificates">
                <div class="subtitle">{% trans "Select # Certificates" %}</div>
                <div class="select">
                    <select name="num_certificates" id="num_certificates">
                        {% mkrange 1 50 as some_range %}
                        {% for n in some_range %}
                        <option value="{{ n }}"{% if num_certificates == n|stringformat:"d" %}selected{% endif %}>{{ n }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
                
            <div class="selection" id="submit">
                <div class="subtitle"></div>
                <div class="select">
                    <input type="submit" value="{% trans "Download now!"%}" />
                </div>
            </div>
            {% endif %}
        </form>
    {% comment "Output install certificates for viewing, in debug mode only %}{% endcomment %}
    {% if debug %}
        <div>
        install_certificates = {{ install_certificates }}
        </div>
    </div>
    {% endif %}
<script>

function setGetParam(name, val) {
    var vars = {};
    var parts = window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
        vars[key] = value;
    });
    if (val != "" && val != "----") {
        vars[name] = val;
    } else {
        delete vars[name];
    }
    url = "?" + $.param(vars);
    window.location.href = url;    
}

$(function() {
    // When selected, refresh the page
    $("#organization").change(function(){
       setGetParam("organization", $("#organization option:selected").val()); 
    });
    
    $("#zone").change(function(){
       setGetParam("zone", $("#zone option:selected").val()); 
    });
    
    $("#num_certificates").change(function(){
       setGetParam("num_certificates", $("#num_certificates option:selected").val()); 
    });
    
});
</script>
{% endif %}
{% endblock %}
